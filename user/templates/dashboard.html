<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>DASHGUM - FREE Bootstrap Admin Template</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.css"   rel="stylesheet">
    <!--external css-->
    <link href="/static/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/static/css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="/static/js/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="/static/lineicons/style.css">



    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/style-responsive.css" rel="stylesheet">

    <script src="/static/js/chart-master/Chart.js"></script>
    <script src="/static/js/echarts.min.js"></script>
        <!-- js placed at the end of the document so the pages load faster -->
    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/jquery-1.8.3.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="/static/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="/static/js/jquery.scrollTo.min.js"></script>
    <script src="/static/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="/static/js/jquery.sparkline.js"></script>


    <!--common script for all pages-->
    <script src="/static/js/common-scripts.js"></script>

    <script type="text/javascript" src="/static/js/gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="/static/js/gritter-conf.js"></script>

    <!--script for this page-->
    <script src="/static/js/sparkline-chart.js"></script>
	<script src="/static/js/zabuto_calendar.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>


  <body>

  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>快兔出行</b></a>
            <!--logo end-->

            <div class="top-menu">

            </div>

        </header>
      <!--header end-->

      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">

              	  <p class="centered"><a href="profile.html"><img src="/static/img/ui-sam.jpg" class="img-circle" width="60"></a></p>
              	  <h5 class="centered">V1Group</h5>

                  <li class="mt">
                      <a class="active">
                          <i class="fa fa-dashboard"></i>
                          <span>总览</span>
                      </a>
                  </li>



              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->

      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">

              <div class="row">
                  <div class="col-lg-9 main-chart">

                  	<div class="row mtbox">
                  		<div class="col-md-2 col-sm-2 col-md-offset-1 box0">
                  			<div class="box1">
					  			<span class="li_heart"></span>
					  			<h3>{{ user_count }}</h3>
                  			</div>
					  			<p>{{ user_count }} 位用户注册了快兔出行。</p>
                  		</div>
                  		<div class="col-md-2 col-sm-2 box0">
                  			<div class="box1">
					  			<span class="li_cloud"></span>
					  			<h3>{{ totalbike }}</h3>
                  			</div>
					  			<p>截至目前，快兔出行总共在{{ totalcity }}个城市投放{{ totalbike }}台车辆</p>
                  		</div>
                  		<div class="col-md-2 col-sm-2 box0">
                  			<div class="box1">
					  			<span class="li_stack"></span>
					  			<h3>{{ totalcity }}</h3>
                  			</div>
					  			<p>目前快兔出行布局{{ totalcity }}城</p>
                  		</div>
                  		<div class="col-md-2 col-sm-2 box0">
                  			<div class="box1">
					  			<span class="li_news"></span>
					  			<h3>{{ total_bail }}</h3>
                  			</div>
					  			<p>目前总计有自行车押金{{ total_bail }}元</p>
                  		</div>
                  		<div class="col-md-2 col-sm-2 box0">
                  			<div class="box1">
					  			<span class="li_data"></span>
					  			<h3>{{ month_user_sum }}</h3>
                  			</div>
					  			<p>本月新增用户数目为{{ month_user_sum }}</p>
                  		</div>

                  	</div><!-- /row mt -->


                      <div class="row mt">
                      <!-- SERVER STATUS PANELS -->
                      	<div class="col-md-4 col-sm-4 mb">
                      		<div class="white-panel pn donut-chart">
								<div id="serverstatus01" style="width: 520px;height:350px;margin:10px 10px 10px 20px;"></div>
                                <script type="text/javascript">
                                    // 基于准备好的dom，初始化echarts实例
                                    var myChart = echarts.init(document.getElementById('serverstatus01'));

                                    // 指定图表的配置项和数据
                                    var city_list={{ city_list | safe }}
                                    var user_count_list={{ user_count_list | safe}}
                                    var option = {
                                        title: {
                                            text: '用户信息展示'
                                        },
                                        tooltip: {},
                                        legend: {
                                            data:['用户数目']
                                        },
                                        xAxis: {
                                            data: city_list
                                        },
                                        yAxis: {},
                                        series: [{
                                            name: '用户数目',
                                            type: 'bar',
                                            data: user_count_list
                                        }]
                                    };

                                    // 使用刚指定的配置项和数据显示图表。
                                    myChart.setOption(option);
                                </script>


	                      	</div><! --/grey-panel -->
                      	</div><!-- /col-md-4-->


                      	<div class="col-md-4 col-sm-4 mb">
                      		<div class="white-panel pn">
                      			<div id="serverstatus04" style="width: 520px;height:350px;margin:10px 10px 10px 20px;"></div>
                                <script type="text/javascript">
                                    // 基于准备好的dom，初始化echarts实例
                                    var myChart = echarts.init(document.getElementById('serverstatus04'));

                                    // 指定图表的配置项和数据
                                    var gender={{ gender | safe }}

                                    var gender_count={{ gender_count | safe}}

                                option = {
                                        title : {
                                            text: '快兔单车用户数据',
                                            subtext: '性别分类',
                                            x:'center'
                                            },
                                        tooltip : {
                                            trigger: 'item',
                                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                                        },
                                        legend: {
                                            orient: 'vertical',
                                            left: 'left',
                                            data: gender
                                        },
                                        series : [
                                            {
                                                    name: '访问来源',
                                                    type: 'pie',
                                                    radius : '55%',
                                                    center: ['50%', '60%'],
                                                    data:[
                                                    {value:gender_count[0], name:gender[0]},
                                                    {value:gender_count[1], name:gender[1]},
                                                    {value:gender_count[2], name:gender[2]}
                                                        ],
                                                    itemStyle: {
                                                        emphasis: {
                                                            shadowBlur: 10,
                                                            shadowOffsetX: 0,
                                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                                            }
                                                        }
                                                    }
                                            ]
                                    };

                                    // 使用刚指定的配置项和数据显示图表。
                                    myChart.setOption(option);
                                </script>



                      		</div>
                      	</div><!-- /col-md-4 -->

						<div class="col-md-4 mb">
							<!-- WHITE PANEL - TOP USER -->
							<div class="white-panel pn">
								<div id="serverstatus05" style="width: 520px;height:350px;margin:10px 10px 10px 20px;"></div>
                                <script type="text/javascript">
                                    // 基于准备好的dom，初始化echarts实例
                                    var myChart = echarts.init(document.getElementById('serverstatus05'));

                                    // 指定图表的配置项和数据
                                    var platform={{ platform | safe }}

                                    var platform_count={{ platform_count | safe}}

                                option = {
                                        title : {
                                            text: '快兔单车用户数据',
                                            subtext: '平台分类',
                                            x:'center'
                                            },
                                        tooltip : {
                                            trigger: 'item',
                                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                                        },
                                        legend: {
                                            orient: 'vertical',
                                            left: 'left',
                                            data: gender
                                        },
                                        series : [
                                            {
                                                    name: '访问来源',
                                                    type: 'pie',
                                                    radius : '55%',
                                                    center: ['50%', '60%'],
                                                    data:[
                                                    {value:platform_count[0], name:platform[0]},
                                                    {value:platform_count[1], name:platform[1]},
                                                    {value:platform_count[2], name:platform[2]}
                                                        ],
                                                    itemStyle: {
                                                        emphasis: {
                                                            shadowBlur: 10,
                                                            shadowOffsetX: 0,
                                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                                            }
                                                        }
                                                    }
                                            ]
                                    };

                                    // 使用刚指定的配置项和数据显示图表。
                                    myChart.setOption(option);
                                </script>



                      		</div>
                      	</div><!-- /col-md-4 -->


                    </div><!-- /row -->




                  </div><!-- /col-lg-9 END SECTION MIDDLE -->


      <!-- **********************************************************************************************************************************************************
      RIGHT SIDEBAR CONTENT

              </div><! --/row -->
    <div>
 <div class="col-md-4 mb">
							<!-- WHITE PANEL - TOP USER -->

     <div>
         <form>
          <p>月注册用户数量展示</p>
         <select id="gender">
            <option value ="3" selected>全部</option>
            <option value ="1">男性</option>
             <option value ="2">女性</option>
            <option value="0">默认</option>
         </select>
         <select id="paltform">
            <option value ="3" selected>全部</option>
            <option value ="1">安卓</option>
             <option value ="2">iOS</option>
            <option value="0">默认</option>
         </select>
         <button type="button" id='user_button'>提交</button>

         </form>
         <div id="user_show" style="width: 1600px;height:500px;margin:10px 10px 10px 20px;"></div>



    <script>
    $(document).ready(function(){
        first_run()
        dau_first()
      $("#user_button").click(function(){
        var gender = $("#gender").val();
        var platform = $("#paltform").val();
        $.ajax({
            type:"GET",
            url:"/city_user",
            data:{"gender":gender,
                "platform":platform
            },
            data_type:"json",
            success: function(ret){
                    callback(ret)
                     }
        })
      });
        $("#dau_button").click(function(){
        var platform= $("input[name='platform_dau']:checked").val();
        var start= document.querySelector('input[name="startday"]').value;
        var end= document.querySelector('input[name="endday"]').value;
        $.ajax({
            type:"GET",
            url:"/dau",
            data:{"start_date":start,
                "end_date":end,
                "platform":platform
            },
            data_type:"json",
            success: function(ret){
                    dau_callback(ret)
                     }
        })
      });
    });
    function first_run() {
        var gender = $("#gender").val();
        var platform = $("#paltform").val();
        $.ajax({
            type:"GET",
            url:"/city_user",
            data:{"gender":gender,
                "platform":platform
            },
            data_type:"json",
            success: function(ret){
                    callback(ret)
                     }
        })
    }
    function dau_first() {
        var platform= $("input[name='platform_dau']:checked").val();
        var start= document.querySelector('input[name="startday"]').value;
        var end= document.querySelector('input[name="endday"]').value;
        $.ajax({
            type:"GET",
            url:"/dau",
            data:{"start_date":start,
                "end_date":end,
                "platform":platform
            },
            data_type:"json",
            success: function(ret){
                    dau_callback(ret)
                     }
        })
    }
    function dau_callback(json) {
        var dau=json['dau']
        var day=json['day']
        var dauChart = echarts.init(document.getElementById('dau_show'));
        option={
            xAxis:{
                type:'category',
                data:day
            },
            yAxis:{
                type:'value'
            },
            series:[{
                itemStyle : { normal: {label : {show: true}}},
                data: dau,
                type: 'line'
            }
            ]
        };
        dauChart.setOption(option);
    }
    function callback(json){
        var user_conut_sum=json['count']
        var month=json['month']
        var myChart = echarts.init(document.getElementById('user_show'));
                                option = {

    xAxis: {
        type: 'category',
        data: month
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        itemStyle : { normal: {label : {show: true}}},
        data: user_conut_sum,
        type: 'line'
    }]
};
                                    // 使用刚指定的配置项和数据显示图表。
                                    myChart.setOption(option);

    }

    </script>
     </div>

                      	</div><!-- /col-md-4 -->
    </div>
              </div>
      <div>

          <form>
                <p>DAU展示：</p>
                 <div>
                     <label for="start">开始:</label>
                     <input type="date" id="startday" name="startday" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" value="2017-04-01">
                     <label for="end">结束:</label>
                     <input type="date" id="endday" name="endday" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" value="2017-04-07">

                     <label for="platform_dau">     平台用户:   </label>

                     <input type="radio" name="platform_dau" id="andriod" value="1"> Andriod
                     <input type="radio" name="platform_dau" id="ios" value="2"> iOS
                     <input type="radio" name="platform_dau" id="all" value="3" checked> ALL

                     <button type="button" id='dau_button'>提交</button>
                </div>
          </form>
          <div id="dau_show" style="width: 1600px;height:500px;margin:10px 10px 10px 20px;"></div>
          <script>
              
          </script>
    </div>

          </section>
      </section>

      <!--main content end-->
      <!--footer start-->
      <footer class="site-footer">
          <div class="text-center">
              2014 - Alvarez.is
              <a href="index.html#" class="go-top">
                  <i class="fa fa-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>


	<script type="application/javascript">
        $(document).ready(function () {
            $("#date-popover").popover({html: true, trigger: "manual"});
            $("#date-popover").hide();
            $("#date-popover").click(function (e) {
                $(this).hide();
            });

            $("#my-calendar").zabuto_calendar({
                action: function () {
                    return myDateFunction(this.id, false);
                },
                action_nav: function () {
                    return myNavFunction(this.id);
                },
                ajax: {
                    url: "show_data.php?action=1",
                    modal: true
                },
                legend: [
                    {type: "text", label: "Special event", badge: "00"},
                    {type: "block", label: "Regular event", }
                ]
            });
        });


        function myNavFunction(id) {
            $("#date-popover").hide();
            var nav = $("#" + id).data("navigation");
            var to = $("#" + id).data("to");
            console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
        }
    </script>

  <script type="text/javascript">

type = 'all';

$(document).ready(function() {

	$('.ovtab a').click(function(e) {
		e.stopPropagation();
	})

	$('.ovtab').click(function() {

		type = $(this).attr('id').replace('_box', '');

		//$('.metrics div div').css('border-color', $(this).css('border-top-color'));
		$('.metrics div div').removeClass('ad').removeClass('organic').removeClass('search').addClass(type);

		$('.ovtab').removeClass('active');
		$(this).addClass('active');

		$('.btn-report').hide();
		$('#' + type + '_report').show();

		getMetrics();

	});

	getMetrics();
	getTabs();

});

function getTabs(start, end) {
	// Get Tab Metrics
	var jsonurl = '/api/metrics.json?graph=1&filters[goal]=' + encodeURIComponent(userprefs.goal);
	jsonurl += '&type=' + type;
	if (typeof start != 'undefined' && typeof end != 'undefined')
		jsonurl += '&start=' + encodeURIComponent(start) + '&end=' + encodeURIComponent(end);

	$('.ovtab .num').html('<i class="fa fa-spinner fa-spin"></i>');
	$.getJSON(jsonurl, function(data) {
		$('.ovtab .num').html('0');
		var tv = 0, tc = 0;
		for (var i = 0; i < data.length; i++) {
			var row = data[i];
			$('#' + row['type'] + '_box .num:first').html(add_commas(row['visits']));
			$('#' + row['type'] + '_box .num:last').html(add_commas(row['conversions']));
			tv += parseInt(row['visits']);
			tc += parseInt(row['conversions']);
		}
		$('#all_box .num:first').html(add_commas(tv));
		$('#all_box .num:last').html(add_commas(tc));
	});
}




  </body>
</html>
